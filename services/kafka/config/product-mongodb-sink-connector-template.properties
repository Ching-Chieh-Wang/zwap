name=product-mongodb-sink-connector
topics=product-mongodb-write
connector.class=com.mongodb.kafka.connect.MongoSinkConnector
tasks.max=1

# MongoDB connection
connection.uri=${PRODUCT_MONGODB_SERVICE_URI}
database=product
collection=products

# --- PRIMARY ID STRATEGY (Required for deletes) ---
# Use PartialKeyStrategy so deletes and updates work when _id is in the key
document.id.strategy=com.mongodb.kafka.connect.sink.processor.id.strategy.PartialKeyStrategy
key.projection.type=ALLOWLIST
key.projection.list=_id

# --- POST-PROCESSOR CHAIN (Fallback for inserts) ---
# If key is null, try to get _id from value; if not present, Mongo auto-generates
post.processor.chain=com.mongodb.kafka.connect.sink.processor.DocumentIdAdder
post.processor.document.id.strategy=com.mongodb.kafka.connect.sink.processor.id.strategy.PartialValueStrategy
post.processor.document.id.strategy.partial.value.projection={"_id": 1}

# --- WRITE MODEL STRATEGY ---
# Upsert: update if _id exists, insert otherwise
write.strategy=com.mongodb.kafka.connect.sink.writemodel.strategy.UpdateOneDefaultStrategy

# --- ENABLE DELETES ---
delete.on.null.values=true

# --- ERROR HANDLING ---
max.batch.size=500
errors.tolerance=all
errors.log.enable=true
errors.log.include.messages=true