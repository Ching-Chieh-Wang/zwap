name=product-mongodb-sink-connector
topics=product-mongodb-write
connector.class=com.mongodb.kafka.connect.MongoSinkConnector
tasks.max=1

connection.uri=${PRODUCT_MONGODB_SERVICE_URI}
database=product
collection=products

# --- PRIMARY ID STRATEGY (MUST BE KEY-BASED for delete.on.null.values=true) ---
# This dictates how the connector gets the _id for delete operations from the Kafka KEY.
# It also provides the default _id if no post-processor overrides it for inserts/updates.
document.id.strategy=com.mongodb.kafka.connect.sink.processor.id.strategy.PartialKeyStrategy
key.projection.type=ALLOWLIST
key.projection.list=_id

# --- POST-PROCESSOR (Handles _id from VALUE for Inserts/Updates) ---
# The DocumentIdAdder is the default post-processor, used for normal upserts.
# We configure its internal behavior to look for _id in the VALUE for these operations.
post.processor.chain=com.mongodb.kafka.connect.sink.processor.DocumentIdAdder
# These properties configure how the *DocumentIdAdder* post-processor extracts _id from the VALUE.
value.projection.type=ALLOWLIST
value.projection.list=_id

# --- WRITE MODEL STRATEGY ---
write.strategy=com.mongodb.kafka.connect.sink.writemodel.strategy.UpdateOneDefaultStrategy

# --- ENABLE DELETES (Now compatible with key-based IdStrategy) ---
delete.on.null.values=true

max.batch.size=500
errors.tolerance=all
errors.log.enable=true
errors.log.include.messages=true