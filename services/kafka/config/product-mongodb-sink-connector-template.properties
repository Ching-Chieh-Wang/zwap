name=product-mongodb-sink-connector
topics=product-mongodb-write
connector.class=com.mongodb.kafka.connect.MongoSinkConnector
tasks.max=1

# Specific global MongoDB Sink Connector configuration
connection.uri=${PRODUCT_MONGODB_SERVICE_URI}

database=product
collection=products

# Project the '_id' field from the Kafka record's KEY
key.projection.type=ALLOWLIST
key.projection.list=_id

# --- KEEP Value-based for Inserts/Updates (Requires a Post Processor!) ---
# You'll need a Post-Processor to handle ID from VALUE for inserts/updates
# The default `post.processor.chain` is usually `DocumentIdAdder`, which uses `BsonOidStrategy` by default
# We need it to use `PartialValueStrategy` for updates/inserts when _id is in value
post.processor.chain=com.mongodb.kafka.connect.sink.processor.DocumentIdAdder
document.id.strategy.partial.value.projection={"_id": 1}
# And ensure the post-processor's internal strategy is PartialValueStrategy
document.id.strategy=com.mongodb.kafka.connect.sink.processor.id.strategy.PartialKeyStrategy


# --- Write Model Strategy for Upserts ---
write.strategy=com.mongodb.kafka.connect.sink.writemodel.strategy.UpdateOneDefaultStrategy

# --- Enable Deletes (Now compatible with Key-based IdStrategy) ---
delete.on.null.values=true

max.batch.size=500
errors.tolerance=all
errors.log.enable=true
errors.log.include.messages=true