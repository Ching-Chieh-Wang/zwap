name=product-mongodb-sink-connector
topics=product-mongodb-write
connector.class=com.mongodb.kafka.connect.MongoSinkConnector
tasks.max=1

connection.uri=${PRODUCT_MONGODB_SERVICE_URI}
database=product
collection=products

# --- PRIMARY ID STRATEGY (MongoDB generates _id for inserts) ---
document.id.strategy=com.mongodb.kafka.connect.sink.processor.id.strategy.BsonOidStrategy

# --- POST-PROCESSOR CHAIN (Handles _id from VALUE for Inserts/Updates) ---
post.processor.chain=com.mongodb.kafka.connect.sink.processor.DocumentIdAdder
value.projection.type=ALLOWLIST
value.projection.list=_id
post.processor.document.id.strategy=com.mongodb.kafka.connect.sink.processor.id.strategy.PartialValueStrategy
post.processor.document.id.strategy.partial.value.projection={"_id": 1}

# --- WRITE MODEL STRATEGY ---
write.strategy=com.mongodb.kafka.connect.sink.writemodel.strategy.UpdateOneDefaultStrategy

# --- DELETES DISABLED VIA CONNECTOR ---
# No delete.on.null.values property, or set to false explicitly:
# delete.on.null.values=false

# If using CDC, enable the appropriate handler:
# change.data.capture.handler=com.mongodb.kafka.connect.sink.cdc.debezium.mongodb.MongoDbHandler

max.batch.size=500
errors.tolerance=all
errors.log.enable=true
errors.log.include.messages=true